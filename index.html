<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán ƒê·ªçc S·ªë Ti·ªÅn Ti·∫øng Trung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Be+Vietnam+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Be Vietnam Pro', sans-serif; }
        .zh-font { font-family: 'Noto Sans SC', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center py-10 px-4">

    <!-- Header -->
    <header class="text-center mb-8">
        <h1 class="text-3xl font-bold text-slate-800 mb-2">Luy·ªán Ph·∫£n X·∫° S·ªë Ti·ªÅn üá®üá≥</h1>
        <p class="text-slate-600">Luy·ªán t∆∞ duy chuy·ªÉn t·ª´ "ngh√¨n" (3 s·ªë) sang "v·∫°n" (4 s·ªë)</p>
    </header>

    <!-- Main Card -->
    <main class="w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        
        <!-- Display Section -->
        <div class="p-8 bg-indigo-600 text-white text-center relative">
            <div class="text-indigo-200 text-sm font-semibold uppercase tracking-wider mb-2">S·ªë ti·ªÅn (VND/RMB)</div>
            
            <!-- Standard View (Vietnamese style) -->
            <div id="displayNumber" class="text-4xl font-bold tracking-tight mb-2 font-mono">0</div>
            
            <!-- Visual Aid (Chinese style grouping) -->
            <div id="visualAid" class="text-sm bg-indigo-800/50 inline-block px-3 py-1 rounded-full mt-2 hidden">
                <span class="text-indigo-300">T∆∞ duy: </span>
                <span id="chineseGroupNumber" class="font-mono text-white"></span>
            </div>
        </div>

        <!-- Controls -->
        <div class="p-6 grid gap-4">
            
            <!-- Settings -->
            <div class="flex justify-between items-center mb-2">
                <label class="text-sm text-slate-600 flex items-center gap-2">
                    <input type="checkbox" id="toggleAid" class="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500" checked>
                    <span>Hi·ªán g·ª£i √Ω nh√≥m 4 s·ªë (Wan)</span>
                </label>
                <select id="difficulty" class="text-sm border-slate-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-1 border">
                    <option value="easy">D·ªÖ (H√†ng ngh√¨n)</option>
                    <option value="medium" selected>Trung b√¨nh (H√†ng V·∫°n)</option>
                    <option value="hard">Kh√≥ (H√†ng ·ª®c/T·ª∑)</option>
                </select>
            </div>

            <!-- Action Buttons -->
            <button onclick="generateNumber()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl shadow-lg shadow-indigo-200 transition-all active:scale-95 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                T·∫°o s·ªë ng·∫´u nhi√™n
            </button>

            <button onclick="toggleAnswer()" id="btnShowAnswer" class="w-full py-3 bg-white border-2 border-slate-200 text-slate-700 hover:bg-slate-50 font-semibold rounded-xl transition-all active:scale-95">
                Xem ƒë√°p √°n
            </button>

            <!-- Answer Section (Hidden by default) -->
            <div id="answerSection" class="hidden mt-4 p-4 bg-yellow-50 rounded-xl border border-yellow-100 fade-in text-center">
                <div class="text-xs text-yellow-600 font-semibold uppercase mb-1">H√°n t·ª±</div>
                <div id="hanziResult" class="zh-font text-2xl text-slate-800 mb-2 font-medium"></div>
                
                <div class="text-xs text-yellow-600 font-semibold uppercase mb-1 mt-3">Pinyin</div>
                <div id="pinyinResult" class="text-lg text-indigo-600 font-medium"></div>
            </div>

        </div>
    </main>
    
    <div class="mt-8 max-w-md text-sm text-slate-500 bg-white p-4 rounded-lg shadow-sm border border-slate-200">
        <h3 class="font-bold text-slate-700 mb-2">M·∫πo nh·ªõ nhanh:</h3>
        <ul class="list-disc pl-4 space-y-1">
            <li>Ti·∫øng Vi·ªát t√°ch 3 s·ªë: <span class="font-mono">10,000,000</span> (10 Tri·ªáu)</li>
            <li>Ti·∫øng Trung t√°ch 4 s·ªë: <span class="font-mono">1000,0000</span> (1000 V·∫°n)</li>
            <li><strong>M·∫πo:</strong> Nh√¨n v√†o ph·∫ßn "G·ª£i √Ω" m√†u xanh ƒë·∫≠m ·ªü tr√™n ƒë·ªÉ quen m·∫Øt v·ªõi vi·ªác t√°ch 4 s·ªë.</li>
        </ul>
    </div>

    <script>
        // Mapping basic digits
        const digits = ['Èõ∂', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', '‰∏É', 'ÂÖ´', '‰πù'];
        const pinyinDigits = ['l√≠ng', 'yƒ´', '√®r', 'sƒÅn', 's√¨', 'w«î', 'li√π', 'qƒ´', 'bƒÅ', 'ji«î'];
        
        // Units inside a 4-digit block
        const units = ['', 'ÂçÅ', 'Áôæ', 'ÂçÉ'];
        const pinyinUnits = ['', 'sh√≠', 'b«éi', 'qiƒÅn'];
        
        // Major units (Block separators)
        const bigUnits = ['', '‰∏á', '‰∫ø', 'ÂÖÜ'];
        const pinyinBigUnits = ['', 'w√†n', 'y√¨', 'zh√†o'];

        let currentNumber = 0;
        let isAnswerShown = false;

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateNumber() {
            const difficulty = document.getElementById('difficulty').value;
            let min, max;

            if (difficulty === 'easy') {
                min = 100; max = 99999; // Up to ~10 Wan
            } else if (difficulty === 'medium') {
                min = 10000; max = 99999999; // Up to ~1 Yi
            } else {
                min = 10000000; max = 9999999999; // Billions
            }

            currentNumber = getRandomInt(min, max);
            
            // Render numbers
            const formattedVN = new Intl.NumberFormat('vi-VN').format(currentNumber);
            document.getElementById('displayNumber').innerText = formattedVN;

            // Render Chinese Visual Aid (Grouping by 4)
            renderChineseGrouping(currentNumber);

            // Hide Answer
            document.getElementById('answerSection').classList.add('hidden');
            document.getElementById('btnShowAnswer').innerText = 'Xem ƒë√°p √°n';
            document.getElementById('btnShowAnswer').classList.remove('bg-slate-100');
            isAnswerShown = false;
        }

        function renderChineseGrouping(num) {
            let str = num.toString();
            let result = [];
            let count = 0;
            // Iterate from right to left
            for (let i = str.length - 1; i >= 0; i--) {
                count++;
                result.unshift(str[i]);
                if (count % 4 === 0 && i !== 0) {
                    result.unshift("'"); // Use apostrophe or comma as separator
                }
            }
            // Display: 1'2345'6789
            const grouped = result.join('').replace(/'/g, '<span class="text-yellow-300 mx-0.5">|</span>');
            document.getElementById('chineseGroupNumber').innerHTML = grouped;
            
            const showAid = document.getElementById('toggleAid').checked;
            document.getElementById('visualAid').className = showAid ? 
                "text-sm bg-indigo-800/50 inline-block px-3 py-1 rounded-full mt-2 fade-in" : "hidden";
        }

        function toggleAnswer() {
            const answerDiv = document.getElementById('answerSection');
            const btn = document.getElementById('btnShowAnswer');
            
            if (isAnswerShown) {
                answerDiv.classList.add('hidden');
                btn.innerText = 'Xem ƒë√°p √°n';
                isAnswerShown = false;
            } else {
                const { hanzi, pinyin } = numberToChinese(currentNumber);
                document.getElementById('hanziResult').innerText = hanzi;
                document.getElementById('pinyinResult').innerText = pinyin;
                
                answerDiv.classList.remove('hidden');
                btn.innerText = '·∫®n ƒë√°p √°n';
                isAnswerShown = true;
            }
        }

        // Core Logic: Convert Number to Chinese (Simplified for Reading Money)
        function numberToChinese(num) {
            if (num === 0) return { hanzi: digits[0], pinyin: pinyinDigits[0] };

            let str = num.toString();
            let len = str.length;
            
            // Split into blocks of 4 digits from right to left
            let blocks = [];
            while (str.length > 0) {
                blocks.push(str.slice(Math.max(0, str.length - 4)));
                str = str.slice(0, Math.max(0, str.length - 4));
            }

            let hanziRes = "";
            let pinyinRes = "";

            // Process blocks from largest to smallest
            for (let i = blocks.length - 1; i >= 0; i--) {
                let blockNum = parseInt(blocks[i]);
                if (blockNum === 0) {
                    // Handling zero between blocks (e.g. 1,0000,5000)
                    if (i !== blocks.length - 1 && i > 0 && parseInt(blocks[i-1]) > 0) {
                        hanziRes += digits[0];
                        pinyinRes += pinyinDigits[0] + " ";
                    }
                    continue; 
                }

                // Convert the 4-digit block
                let blockData = readBlock(blocks[i], i === blocks.length - 1 && blocks[i].length < 4); 
                
                hanziRes += blockData.hanzi;
                pinyinRes += blockData.pinyin;

                // Add Big Unit (Wan, Yi)
                if (i > 0) {
                    hanziRes += bigUnits[i];
                    pinyinRes += pinyinBigUnits[i] + " ";
                }
                
                // Add "Ling" if the next block is coming and it starts with 0 or is < 1000
                // This is a simplified rule for the app context
                if (i > 0) {
                     let nextBlockVal = parseInt(blocks[i-1]);
                     if (nextBlockVal > 0 && nextBlockVal < 1000) {
                         hanziRes += digits[0];
                         pinyinRes += pinyinDigits[0] + " ";
                     }
                }
            }
            
            // Clean up: Remove trailing Ling, fix double spaces
            hanziRes = hanziRes.replace(/Èõ∂+$/, '').replace(/Èõ∂+/g, 'Èõ∂');
            pinyinRes = pinyinRes.trim().replace(/\s+/g, ' ');

            return { hanzi: hanziRes, pinyin: pinyinRes };
        }

        function readBlock(str, isLeadingBlock) {
            // Fill leading zeros for processing if it's not the leading block
            // E.g. internal block "0050"
            let num = parseInt(str);
            let tempStr = num.toString();
            
            let h = "";
            let p = "";
            
            let len = tempStr.length;
            let hasZero = false;

            for (let j = 0; j < len; j++) {
                let digit = parseInt(tempStr[j]);
                let position = len - 1 - j; // 3=qian, 2=bai, 1=shi, 0=unit

                if (digit === 0) {
                    hasZero = true;
                } else {
                    if (hasZero) {
                        h += digits[0];
                        p += pinyinDigits[0] + " ";
                        hasZero = false;
                    }
                    
                    // Special case: "Yi Shi" (One Ten) at start of number -> usually just "Shi"
                    // But for money/clarity, "Yi Shi" is often acceptable or preferred in full reading.
                    // We will keep it standard: "Yi Shi" 
                    
                    // Special case: 2 (Er vs Liang). Simplified: Use Liang for Qian/Bai/Wan beginnings
                    // But for this drill app, "Er" is safe. "Liang" is better for 200/2000.
                    let char = digits[digit];
                    let py = pinyinDigits[digit];
                    
                    if (digit === 2 && (position >= 1)) { 
                        // Simple rule: use Liang for hundreds/thousands/ten-thousands
                         // char = '‰∏§'; py = 'li«éng'; // Uncomment to enable Liang
                    }

                    h += char;
                    p += py + " ";
                    
                    if (position > 0) {
                        h += units[position];
                        p += pinyinUnits[position] + " ";
                    }
                }
            }
            return { hanzi: h, pinyin: p };
        }

        // Listener for checkbox
        document.getElementById('toggleAid').addEventListener('change', function() {
            const el = document.getElementById('visualAid');
            if(this.checked) {
                el.classList.remove('hidden');
                el.classList.add('fade-in');
            } else {
                el.classList.add('hidden');
            }
        });

        // Init
        generateNumber();

    </script>
</body>
</html>
